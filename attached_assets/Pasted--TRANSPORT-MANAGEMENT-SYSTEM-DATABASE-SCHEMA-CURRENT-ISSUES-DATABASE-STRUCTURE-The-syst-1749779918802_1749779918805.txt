**TRANSPORT MANAGEMENT SYSTEM - DATABASE SCHEMA & CURRENT ISSUES**

**DATABASE STRUCTURE:**
The system manages transport for 4 Monarch organizations, each with multiple physical locations:

**Organizations (Businesses):**
- `monarch_competency`
- `monarch_launch` 
- `monarch_mental_health`
- `monarch_sober_living`

**Service Areas (Physical Locations):**
- Multiple locations per organization
- Clients assigned to `organization_id` + `service_area_id`

**Client Groups (Transport Batching):**
- Groups of clients for efficient routing
- Also have `organization_id` + `service_area_id`

**Drivers (Cross-Organizational Resources):**
- Have `primary_organization_id` but work across all organizations
- Flexible assignment for optimal resource utilization

**Trips (Transport Operations):**
- Assigned `organization_id`
- Can transport clients/groups across service areas within organization

**USER ROLES:**
- `super_admin`: System-wide access
- `monarch_owner`: All Monarch organizations access
- `organization_admin`: Single organization + all its service areas
- `organization_user`: Booking kiosk for one organization
- `driver`: Cross-organization capability

**CURRENT PROBLEMS:**

1. **Column Name Mismatch in Drivers Query:**
   - Error: `column drivers.organization_id does not exist`
   - Fix: Change to `primary_organization_id` in `getDriversByOrganization` function
   - Location: `server/supabase-storage.ts` line 242

2. **Driver Query Logic Issue:**
   - Current: Filtering drivers by single organization
   - Problem: Drivers work cross-organization, so filtering by one org may hide available drivers
   - Solution: Consider showing all drivers or drivers authorized for current organization

**IMMEDIATE FIXES NEEDED:**
1. Fix column name from `organization_id` to `primary_organization_id` in drivers query
2. Verify driver query logic matches cross-organizational assignment model
3. Ensure `admin_001` user can see appropriate drivers for transport scheduling

**GOAL:** Enable proper driver management for multi-organizational transport operations.
——————————
**EVALUATING CROSS-ORG ACCESS FOR ORGANIZATION_USER ROLE**

**Question: Can we expand `organization_user` (booking kiosk) access across all Monarch organizations instead of restricting to single org?**

**To assess feasibility, please show me:**
1. **Users table schema** - How are permissions stored?
2. **Current authorization logic** - Where are the 403 org checks?
3. **Organization switching mechanism** - How does user change context?
4. **Booking interface constraints** - Any single-org assumptions in UI?

**Goal: Enable booking kiosk users to book transport across all Monarch organizations while maintaining appropriate security boundaries.**
